// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a;e=jQuery,n={},n.error=n.warn=n.log=n.info=n.debug=function(){};if(typeof window!="undefined"&&window!==null&&typeof console!="undefined"&&console!==null&&console.log!=null){if(!window._gCalFlow_quiet){a=["error","warn","info"];for(o=0,u=a.length;o<u;o++)s=a[o],n[s]=function(){return console[s]?console[s].apply(console,arguments):console.log.apply(console,arguments)}}window._gCalFlow_debug&&(n.debug=function(){return console.debug!=null?console.debug.apply(console,arguments):console.log.apply(console,arguments)})}i=function(e,t){var n,r,i,s;t==null&&(t=2);if(10*(t-1)<=e)return e;r="";for(n=i=1,s=t-(""+e).length;1<=s?i<=s:i>=s;n=1<=s?++i:--i)r=r.concat("0");return r.concat(e)},t=function(){function t(e,t){this.target=e,e.addClass("gCalFlow"),e.children().size()>0&&(n.debug("Target node has children, use target element as template."),this.template=e),this.update_opts(t)}return t.demo_apikey="AIzaSyD0vtTUjLXzH4oKCzNRDymL6E3jKBympf0",t.prototype.target=null,t.prototype.template=e('<div class="gCalFlow">\n  <div class="gcf-header-block">\n    <div class="gcf-title-block">\n      <span class="gcf-title"></span>\n    </div>\n  </div>\n  <div class="gcf-item-container-block">\n    <div class="gcf-item-block">\n      <div class="gcf-item-header-block">\n        <div class="gcf-item-date-block">\n          [<span class="gcf-item-daterange"></span>]\n        </div>\n        <div class="gcf-item-title-block">\n          <strong class="gcf-item-title"></strong>\n        </div>\n      </div>\n      <div class="gcf-item-body-block">\n        <div class="gcf-item-description">\n        </div>\n        <div class="gcf-item-location">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="gcf-last-update-block">\n    LastUpdate: <span class="gcf-last-update"></span>\n  </div>\n</div>'),t.prototype.opts={maxitem:15,calid:null,apikey:t.demo_apikey,mode:"upcoming",data_url:null,auto_scroll:!0,scroll_interval:1e4,link_title:!0,link_item_title:!0,link_item_description:!1,link_item_location:!1,link_target:"_blank",item_description_as_html:!1,callback:null,no_items_html:"",globalize_culture:typeof navigator!="undefined"&&navigator!==null&&(navigator.browserLanguage||navigator.language||navigator.userLanguage),globalize_fmt_datetime:"f",globalize_fmt_date:"D",globalize_fmt_time:"t",globalize_fmt_monthday:"M",date_formatter:function(e,t){var n;return typeof Globalize!="undefined"&&Globalize!==null&&Globalize.format!=null?(t?n=this.globalize_fmt_date:n=this.globalize_fmt_datetime,Globalize.format(e,n)):t?""+e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate()):""+e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())+" "+i(e.getHours())+":"+i(e.getMinutes())},daterange_formatter:function(e,t,n){var r,s;s=this.date_formatter(e,n),n&&(t=new Date(t.getTime()-864e5)),r="";if(e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth())typeof Globalize!="undefined"&&Globalize!==null&&Globalize.format!=null?r+=Globalize.format(t,this.globalize_fmt_monthday):r+=""+i(t.getMonth()+1)+"-"+i(t.getDate());return!n&&(e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes())&&(typeof Globalize!="undefined"&&Globalize!==null&&Globalize.format!=null?r+=Globalize.format(t,this.globalize_fmt_time):r+=" "+i(t.getHours())+":"+i(t.getMinutes())),r&&(s+=" - "+r),s}},t.prototype.update_opts=function(t){return n.debug("update_opts was called"),n.debug("old options:",this.opts),this.opts=e.extend({},this.opts,t),n.debug("new options:",this.opts)},t.prototype.gcal_url=function(){var e;if(!this.opts.calid&&!this.opts.data_url)throw n.error("Option calid and data_url are missing. Abort URL generation"),this.target.text("Error: You need to set 'calid' or 'data_url' option."),"gCalFlow: calid and data_url missing";return this.opts.data_url?this.opts.data_url:this.opts.mode==="updates"?(e=(new Date).toJSON(),"https://www.googleapis.com/calendar/v3/calendars/"+this.opts.calid+"/events?key="+this.opts.apikey+"&maxResults="+this.opts.maxitem+"&orderBy=updated&timeMin="+e+"&singleEvents=true"):(e=(new Date).toJSON(),"https://www.googleapis.com/calendar/v3/calendars/"+this.opts.calid+"/events?key="+this.opts.apikey+"&maxResults="+this.opts.maxitem+"&orderBy=startTime&timeMin="+e+"&singleEvents=true")},t.prototype.fetch=function(){var t,r=this;return n.debug("Starting ajax call for "+this.gcal_url()),this.opts.apikey===this.constructor.demo_apikey&&(n.warn("You are using built-in demo API key! This key is provided for tiny use or demo only. Your access may be limited."),n.warn("Please check document and consider to use your own key.")),t=function(e){return n.debug("Ajax call success. Response data:",e),r.render_data(e,r)},e.ajax({type:"GET",success:t,dataType:"jsonp",url:this.gcal_url()})},t.prototype.parse_date=function(e){var t,r,i,s,o,u,a,f,l;return(i=e.match(/^(\d{4})-(\d{2})-(\d{2})$/))?new Date(parseInt(i[1],10),parseInt(i[2],10)-1,parseInt(i[3],10),0,0,0):(u=(new Date).getTimezoneOffset()*60*1e3,l=o=t=null,r=s=f=0,(i=e.match(/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|([+-])(\d{2}):(\d{2}))$/))?(l=parseInt(i[1],10),o=parseInt(i[2],10),t=parseInt(i[3],10),r=parseInt(i[4],10),s=parseInt(i[5],10),f=parseInt(i[6],10),u=(new Date(l,o-1,t,r,s,f)).getTimezoneOffset()*60*1e3,i[7]!=="Z"&&(u+=(i[8]==="+"?1:-1)*(parseInt(i[9],10)*60+parseInt(i[10],10))*1e3*60),n.debug("time parse (gap to local): "+u),a=new Date((new Date(l,o-1,t,r,s,f)).getTime()-u),n.debug("time parse: "+e+" -> ",a),a):(n.warn("Time parse error! Unknown time pattern: "+e),new Date(1970,1,1,0,0,0)))},t.prototype.render_data=function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;n.debug("start rendering for data:",t),g=this.template.clone(),y=(E=this.opts.titlelink)!=null?E:"http://www.google.com/calendar/embed?src="+this.opts.calid,this.opts.link_title?g.find(".gcf-title").html(e("<a />").attr({target:this.opts.link_target,href:y}).text(t.summary)):g.find(".gcf-title").text(t.summary),g.find(".gcf-link").attr({target:this.opts.link_target,href:y}),g.find(".gcf-last-update").html(this.opts.date_formatter(this.parse_date(t.updated))),c=g.find(".gcf-item-block"),c.detach(),c=e(c[0]),n.debug("item block template:",c),h=e(),n.debug("render entries:",t.items),this.opts.item_description_as_html?i="html":i="text";if(t.items!=null&&t.items.length>0){S=t.items.slice(0,+this.opts.maxitem+1||9e9);for(b=0,w=S.length;b<w;b++)o=S[b],n.debug("formatting entry:",o),r=c.clone(),o.start&&(o.start.dateTime?v=o.start.dateTime:v=o.start.date,d=this.parse_date(v),m=this.opts.date_formatter(d,v.indexOf(":")<0),r.find(".gcf-item-date").html(m),r.find(".gcf-item-start-date").html(m)),o.end&&(o.end.dateTime?u=o.end.dateTime:u=o.end.date,s=this.parse_date(u),a=this.opts.date_formatter(s,u.indexOf(":")<0),r.find(".gcf-item-end-date").html(a),r.find(".gcf-item-daterange").html(this.opts.daterange_formatter(d,s,v.indexOf(":")<0))),r.find(".gcf-item-update-date").html(this.opts.date_formatter(this.parse_date(o.updated),!1)),p=e("<a />").attr({target:this.opts.link_target,href:o.htmlLink}),this.opts.link_item_title?r.find(".gcf-item-title").html(p.clone().text(o.summary)):r.find(".gcf-item-title").text(o.summary),this.opts.link_item_description?r.find(".gcf-item-description").html(p.clone()[i](o.description)):r.find(".gcf-item-description")[i](o.description),this.opts.link_item_location?(f="<a href='https://maps.google.de/maps?q="+encodeURI(o.location.replace(" ","+"))+"' target='new'>"+o.location+"</a>",r.find(".gcf-item-location").html(f)):r.find(".gcf-item-location").text(o.location),r.find(".gcf-item-link").attr({href:o.htmlLink}),n.debug("formatted item entry:",r[0]),h.push(r[0])}else h=e('<div class="gcf-no-items"></div>').html(this.opts.no_items_html);n.debug("formatted item entry array:",h),l=g.find(".gcf-item-container-block"),n.debug("item container element:",l),l.html(h),this.target.html(g.html()),this.bind_scroll();if(this.opts.callback)return this.opts.callback.apply(this.target)},t.prototype.bind_scroll=function(){var e,t,r,i,s;t=this.target.find(".gcf-item-container-block"),e=t.find(".gcf-item-block"),n.debug("scroll container:",t);if(!this.opts.auto_scroll||t.size()<1||e.size()<2)return;return s={idx:0},i=function(){var r;return n.debug("current scroll position:",t.scrollTop()),n.debug("scroll capacity:",t[0].scrollHeight-t[0].clientHeight),typeof e[s.idx]=="undefined"||t.scrollTop()>=t[0].scrollHeight-t[0].clientHeight?(n.debug("scroll to top"),s.idx=0,t.animate({scrollTop:e[0].offsetTop})):(r=e[s.idx].offsetTop,n.debug("scroll to "+r+"px"),t.animate({scrollTop:r}),s.idx+=1)},r=setInterval(i,this.opts.scroll_interval)},t}(),r={init:function(e){var n;e==null&&(e={}),n=this.data("gCalFlow");if(!n)return this.data("gCalFlow",{target:this,obj:new t(this,e)})},destroy:function(){var t;return t=this.data("gCalFlow"),t.obj.target=null,e(window).unbind(".gCalFlow"),t.gCalFlow.remove(),this.removeData("gCalFlow")},render:function(){return typeof Globalize!="undefined"&&Globalize!==null&&Globalize.culture!=null&&Globalize.culture(this.data("gCalFlow").obj.opts.globalize_culture),this.data("gCalFlow").obj.fetch()}},e.fn.gCalFlow=function(t){var n;return n=arguments,typeof t=="object"||!t?this.each(function(){return r.init.apply(e(this),n),r.render.apply(e(this),n)}):r[t]?this.each(function(){return r[t].apply(e(this),Array.prototype.slice.call(n,1))}):t==="version"?"3.0.1":e.error("Method "+t+" does not exist on jQuery.gCalFlow")}}).call(this);